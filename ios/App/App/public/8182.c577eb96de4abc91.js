"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8182],{8182:(L,p,s)=>{s.r(p),s.d(p,{VisorPageModule:()=>_});var g=s(9808),v=s(4182),u=s(5056),h=s(1741),d=s(655),f=s(2340),t=s(2096),P=s(3646),y=s(9846),A=s(4657);const C=["theCanvas"];let m=(()=>{class o{constructor(i,e){this.uiSv=i,this.servicio=e,this.url="",this.titulo="",this.storieAudio=void 0,this._ctx=void 0,this._pageNumPending=null,this.pdfjsLib=void 0,this._durationData=[],this._durationPage=void 0,this.pdfDoc=null,this.pageRendering=!1,this.pageNum=1,this.totalPages=1,this.audioUrl=void 0,this.fixedTitle=void 0,this._finished=!1,this.controlAudioIcon="pause"}get storyAudio(){return this.storieAudio}ngOnInit(){return(0,d.mG)(this,void 0,void 0,function*(){const i=this.removeAccents(this.titulo);this.fixedTitle=i,yield this.getData(),this.audioUrl=`${f.N.cuentosUrl}/cuentos/${i}.mp3`,this.pdfjsLib=window["pdfjs-dist/build/pdf"],this.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",this.getPdf()})}getData(){var i;return(0,d.mG)(this,void 0,void 0,function*(){const r=null===(i=(yield this.servicio.consultarCuentos("db.json")).audiosDuration.find(l=>this.removeAccents(l.pdfName)===this.fixedTitle))||void 0===i?void 0:i.data;r.find(l=>l.page===this.pageNum)&&this.renderPage(this.pageNum),this._durationData=r})}removeAccents(i){return i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLocaleLowerCase().replace(/ /g,"_")}setAudio(i){return(0,d.mG)(this,void 0,void 0,function*(){const e=this.storieAudio;e.paused||e.pause(),this._durationPage=this._durationData.find(n=>n.page===i),this._durationPage&&(e.currentTime=this._durationPage.init,this.controlAudioIcon="pause",this._finished=!1,yield e.play())})}checkTime(i){return(0,d.mG)(this,void 0,void 0,function*(){const e=(null==i?void 0:i.target)||this.storieAudio;this._durationPage&&e.currentTime>this._durationPage.end&&(this.controlAudioIcon="play",this._finished=!0,e.pause())})}getPdf(){return(0,d.mG)(this,void 0,void 0,function*(){yield this.uiSv.showLoading(),this._ctx=this.theCanvas.nativeElement.getContext("2d"),this.pdfjsLib.getDocument(this.url).promise.then(i=>(0,d.mG)(this,void 0,void 0,function*(){this.pdfDoc=i,this.totalPages=this.pdfDoc.numPages,yield this.uiSv.dismissLoading(),this.renderPage(this.pageNum)}))})}renderPage(i){var e;return(0,d.mG)(this,void 0,void 0,function*(){try{this.pageRendering=!0;const n=this.theCanvas.nativeElement;yield this.uiSv.showLoading(""),null===(e=this.pdfDoc)||void 0===e||e.getPage(i).then(r=>{const c=r.getViewport({scale:1});n.height=c.height,n.width=c.width;const l={canvasContext:this._ctx,viewport:c};setTimeout(()=>{r.render(l).promise.then(()=>(0,d.mG)(this,void 0,void 0,function*(){this.pageRendering=!1,null!==this._pageNumPending&&(this.renderPage(this._pageNumPending),this._pageNumPending=null),yield this.uiSv.dismissLoading(),this.storieAudio||(yield this.uiSv.showLoading(""),this.storieAudio=new Audio(this.audioUrl),this.storieAudio.addEventListener("canplaythrough",()=>(0,d.mG)(this,void 0,void 0,function*(){this.storieAudio.addEventListener("timeupdate",()=>(0,d.mG)(this,void 0,void 0,function*(){yield this.checkTime()})),yield this.uiSv.dismissLoading()}))),this.setAudio(this.pageNum)}))},100)})}catch(n){console.error(n),yield this.uiSv.dismissLoading()}})}nextPage(i){i&&this.pageNum<this.totalPages?this.pageNum++:!i&&this.pageNum>1&&this.pageNum--,this.renderPage(this.pageNum)}playOrPause(){this.storieAudio.paused?(this.controlAudioIcon="pause",this._finished&&this.setAudio(this.pageNum),this.storieAudio.play()):(this.controlAudioIcon="play",this.storieAudio.pause())}}return o.\u0275fac=function(i){return new(i||o)(t.Y36(y.F),t.Y36(A.H))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-pdf"]],viewQuery:function(i,e){if(1&i&&t.Gf(C,7),2&i){let n;t.iGM(n=t.CRH())&&(e.theCanvas=n.first)}},inputs:{url:"url",titulo:"titulo"},decls:15,vars:3,consts:[[1,"pager"],[3,"click"],["slot","icon-only",3,"name"],["slot","icon-only","name","chevron-back"],["text-wrap",""],["slot","icon-only","name","chevron-forward"],[1,"canvas"],["theCanvas",""]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"ion-buttons")(2,"ion-button",1),t.NdJ("click",function(){return e.playOrPause()}),t._UZ(3,"ion-icon",2),t.qZA()(),t.TgZ(4,"ion-buttons")(5,"ion-button",1),t.NdJ("click",function(){return e.nextPage(!1)}),t._UZ(6,"ion-icon",3),t.qZA()(),t.TgZ(7,"ion-label",4),t._uU(8),t.qZA(),t.TgZ(9,"ion-buttons")(10,"ion-button",1),t.NdJ("click",function(){return e.nextPage(!0)}),t._UZ(11,"ion-icon",5),t.qZA()()(),t.TgZ(12,"div",6),t._UZ(13,"canvas",null,7),t.qZA()),2&i&&(t.xp6(3),t.Q6J("name",e.controlAudioIcon),t.xp6(5),t.AsE(" ",e.pageNum," / ",e.totalPages," "))},dependencies:[u.YG,u.Sm,u.gu,u.Q$],styles:[".pager[_ngcontent-%COMP%], #play-pause[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1rem;align-items:center}.canvas[_ngcontent-%COMP%]{padding:.5rem}.canvas[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{max-width:100%;border-radius:5px}"]}),o})();var T=s(3140);const N=["appPdf"],Z=[{path:"",component:(()=>{class o{constructor(i,e){this.route=i,this.navCtrl=e,this.titulo="Titulo",this.id=this.route.snapshot.paramMap.get("id"),this.url=f.N.cuentosUrl}ngOnInit(){this.titulo=this.route.snapshot.paramMap.get("titulo")}back(){var i;return(0,d.mG)(this,void 0,void 0,function*(){null===(i=this.appPdf.storyAudio)||void 0===i||i.pause(),yield this.navCtrl.navigateBack("tab/principal/cuentos")})}}return o.\u0275fac=function(i){return new(i||o)(t.Y36(h.gz),t.Y36(u.SH))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-visor"]],viewQuery:function(i,e){if(1&i&&t.Gf(N,5),2&i){let n;t.iGM(n=t.CRH())&&(e.appPdf=n.first)}},decls:11,vars:6,consts:[[1,"default-bg"],[1,"ion-margin"],["fill","outline",1,"back-btn",3,"click"],["slot","start","name","arrow-back"],[1,"title"],[3,"url","titulo"],["appPdf",""]],template:function(i,e){1&i&&(t.TgZ(0,"ion-content",0),t._UZ(1,"app-header"),t.TgZ(2,"ion-buttons",1)(3,"ion-button",2),t.NdJ("click",function(){return e.back()}),t._UZ(4,"ion-icon",3),t._uU(5," Retroceder "),t.qZA()(),t.TgZ(6,"h2",4),t._uU(7),t.qZA(),t._UZ(8,"app-pdf",5,6),t.ALo(10,"cuentos"),t.qZA()),2&i&&(t.xp6(7),t.Oqu(e.titulo),t.xp6(1),t.Q6J("url",t.xi3(10,3,e.url,e.titulo))("titulo",e.titulo))},dependencies:[u.YG,u.Sm,u.W2,u.gu,P.G,m,T.e],styles:[".back-btn[_ngcontent-%COMP%]{color:#fff}.title[_ngcontent-%COMP%]{font-size:2.3rem;color:#fff;text-align:center}"]}),o})()}];let b=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[h.Bz.forChild(Z),h.Bz]}),o})();var M=s(5503),G=s(9738);let V=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[g.ez,u.Pc]}),o})(),_=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[g.ez,v.u5,u.Pc,b,M.D,G.K,V]}),o})()}}]);