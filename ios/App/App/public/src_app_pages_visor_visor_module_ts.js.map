{"version":3,"file":"src_app_pages_visor_visor_module_ts.js","mappings":";;;;;;;;;;;;;;;;;;;AAAyC;AACM;AACI;AACN;AAE7C,MAAM,YAAY,GAAG;IACnB,4DAAY;CACb;IAUY,qBAAqB,SAArB,qBAAqB;;AAArB,qBAAqB;IARjC,uDAAQ,CAAC;QACR,YAAY;QACZ,OAAO,EAAE;YACP,yDAAY;YACZ,uDAAW;SACZ;QACD,OAAO,EAAE,YAAY;KACtB,CAAC;GACW,qBAAqB;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;ACjB4D;AAEtC;AACG;AACA;IAQ9C,YAAY,SAAZ,YAAY;IAoBvB,+CAA+C;IAG/C,YACU,IAAe,EACf,QAAyB;QADzB,SAAI,GAAJ,IAAI,CAAW;QACf,aAAQ,GAAR,QAAQ,CAAiB;QAtB1B,QAAG,GAAG,EAAE;QACR,WAAM,GAAG,EAAE;QAEZ,gBAAW,GAAqB,SAAS,CAAC;QAC1C,WAAM,GAAG,GAAG,CAAC;QACb,SAAI,GAAG,SAAS,CAAC;QACjB,oBAAe,GAAG,IAAI,CAAC;QACvB,aAAQ,GAAG,SAAS,CAAC;QACrB,kBAAa,GAAmB,EAAE,CAAC;QACnC,kBAAa,GAAiB,SAAS,CAAC;QAEzC,WAAM,GAAG,IAAI,CAAC;QACd,kBAAa,GAAG,KAAK,CAAC;QACtB,YAAO,GAAG,CAAC,CAAC;QACZ,eAAU,GAAG,CAAC,CAAC;QACf,aAAQ,GAAG,SAAS,CAAC;QACpB,eAAU,GAAW,SAAS,CAAC;IAOnC,CAAC;IAEC,QAAQ;;YACZ,MAAM,UAAU,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACnD,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;YAC7B,MAAM,IAAI,CAAC,OAAO,EAAE,CAAC;YACrB,IAAI,CAAC,QAAQ,GAAG,GAAG,gFAAsB,IAAI,UAAU,MAAM,CAAC;YAC9D,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,sBAAsB,CAAC,CAAC;YAC/C,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,SAAS,GAAG,gDAAgD,CAAC;YAC/F,IAAI,CAAC,MAAM,EAAE,CAAC;QAChB,CAAC;KAAA;IAEK,OAAO;;;YACX,MAAM,IAAI,GAAQ,MAAM,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YAC7D,MAAM,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC;YACrC,IAAI,CAAC,aAAa,GAAG,cAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,UAAU,CAAC,0CAAE,IAAI,CAAC;;KACxG;IAED,aAAa,CAAC,GAAW;QACvB,OAAO,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAC,iBAAiB,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;IACrG,CAAC;IAEK,QAAQ,CAAC,OAAO;;YACpB,MAAM,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC;YACjC,IAAG,CAAC,OAAO,CAAC,MAAM,EAAC;gBACjB,OAAO,CAAC,KAAK,EAAE,CAAC;aACjB;YACD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC;YACxE,IAAG,IAAI,CAAC,aAAa,EAAC;gBACpB,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC;gBAC9C,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;aACtB;QACH,CAAC;KAAA;IAEK,SAAS,CAAC,EAAG;;YACjB,MAAM,OAAO,GAAG,GAAE,aAAF,EAAE,uBAAF,EAAE,CAAE,MAAM,KAAI,IAAI,CAAC,WAAW,CAAC;YAC/C,OAAO,CAAC,GAAG,CAAC,WAAW,IAAI,CAAC,OAAO,2BAA2B,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;YACrF,IAAG,IAAI,CAAC,aAAa,IAAI,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,EAAC;gBACpE,OAAO,CAAC,KAAK,EAAE,CAAC;aACjB;QACH,CAAC;KAAA;IAEK,MAAM;;YACV,MAAM,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YAC9B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YAC1D,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAQ,OAAY,EAAG,EAAE,CAAC;gBACzE,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;gBACtB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;gBACvC,MAAM,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;gBACjC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAChC,CAAC,EAAC,CAAC;QACL,CAAC;KAAA;IAEK,UAAU,CAAC,GAAG;;YAClB,IAAG;gBAED,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;gBAC1B,kCAAkC;gBAClC,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC;gBAC5C,MAAM,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;gBAC7C,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE;oBACrC,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,EAAC,KAAK,EAAE,CAAC,EAAC,CAAC,CAAC;oBAC9C,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;oBACtB,MAAM,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;oBAChC,MAAM,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;oBAE9B,sCAAsC;oBACtC,MAAM,aAAa,GAAG;wBACpB,aAAa,EAAE,IAAI,CAAC,IAAI;wBACxB,QAAQ,EAAE,QAAQ;qBACnB,CAAC;oBAEF,UAAU,CAAC,GAAG,EAAE;wBACd,MAAM,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;wBAE9C,+BAA+B;wBAC/B,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,GAAS,EAAE,CAAC;4BAClC,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;4BAC3B,IAAI,IAAI,CAAC,eAAe,KAAK,IAAI,EAAE;gCACjC,gCAAgC;gCAChC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;gCACtC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;6BAC7B;4BACD,MAAM,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;4BAEjC,IAAG,CAAC,IAAI,CAAC,WAAW,EAAC;gCAEnB,MAAM,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;gCAC/C,IAAI,CAAC,WAAW,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gCAC5C,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,GAAS,EAAE,CAAC;oCAC9D,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,YAAY,EAAE,GAAS,EAAE,CAAC;wCAC1D,sCAAsC;wCACtC,MAAM,IAAI,CAAC,SAAS,EAAE,CAAC;oCACzB,CAAC,EAAC,CAAC;oCACH,MAAM,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;gCACnC,CAAC,EAAC;6BAEH;iCAAI;gCACH,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;6BAC7B;wBAEH,CAAC,EAAC,CAAC;oBACL,CAAC,EAAE,GAAG,CAAC;gBACT,CAAC,CAAC,CAAC;aACJ;YAAA,OAAM,GAAG,EAAC;gBACT,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACnB,MAAM,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;aAElC;YAED,uBAAuB;YACvB,yDAAyD;QAC3D,CAAC;KAAA;IAED,QAAQ,CAAC,OAAO;QACd,IAAG,OAAO,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,EAAC;YAC3C,IAAI,CAAC,OAAO,EAAE,CAAC;SAChB;aAAK,IAAG,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,GAAG,CAAC,EAAC;YACpC,IAAI,CAAC,OAAO,EAAE,CAAC;SAChB;QACD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAChC,CAAC;;;;;;;wBAlJA,oDAAS,SAAC,WAAW,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE;kBAEvC,gDAAK;qBACL,gDAAK;;AAJK,YAAY;IALxB,wDAAS,CAAC;QACT,QAAQ,EAAE,SAAS;QACnB,qEAAmC;;KAEpC,CAAC;GACW,YAAY;AAAA;;;;;;;;;;;;;;;;;;;;ACZgB;AACc;AAEd;AAEzC,MAAM,MAAM,GAAW;IACrB;QACE,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,kDAAS;KACrB;CACF,CAAC;IAMW,sBAAsB,SAAtB,sBAAsB;;AAAtB,sBAAsB;IAJlC,uDAAQ,CAAC;QACR,OAAO,EAAE,CAAC,kEAAqB,CAAC,MAAM,CAAC,CAAC;QACxC,OAAO,EAAE,CAAC,yDAAY,CAAC;KACxB,CAAC;GACW,sBAAsB;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;AChBM;AACM;AACF;AAEA;AAEmB;AAEvB;AACgB;AACe;AACD;IAc1D,eAAe,SAAf,eAAe;;AAAf,eAAe;IAZ3B,uDAAQ,CAAC;QACR,OAAO,EAAE;YACP,yDAAY;YACZ,uDAAW;YACX,uDAAW;YACX,yEAAsB;YACtB,mEAAW;YACX,kFAAgB;YAChB,gFAAqB;SACtB;QACD,YAAY,EAAE,CAAC,kDAAS,CAAC;KAC1B,CAAC;GACW,eAAe;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;ACzBsB;AACD;AACF;AACY;IAQ9C,SAAS,SAAT,SAAS;IAMpB,YACU,KAAqB,EACrB,OAAsB;QADtB,UAAK,GAAL,KAAK,CAAgB;QACrB,YAAO,GAAP,OAAO,CAAe;QANzB,WAAM,GAAG,QAAQ,CAAC;QAClB,OAAE,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAC5C,QAAG,GAAG,gFAAsB,CAAC;IAKhC,CAAC;IAEL,QAAQ;QACN,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC3D,CAAC;IAEK,IAAI;;YACR,MAAM,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,uBAAuB,CAAC,CAAC;QAC3D,CAAC;KAAA;;;;;;AAjBU,SAAS;IANrB,wDAAS,CAAC;QACT,QAAQ,EAAE,WAAW;QACrB,kEAAgC;;KAEjC,CAAC;GAEW,SAAS;AAAA","sources":["./src/app/pages/visor/components/components.module.ts","./src/app/pages/visor/components/pdf/pdf.component.ts","./src/app/pages/visor/visor-routing.module.ts","./src/app/pages/visor/visor.module.ts","./src/app/pages/visor/visor.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { PdfComponent } from './pdf/pdf.component';\nimport { IonicModule } from '@ionic/angular';\n\nconst declarations = [\n  PdfComponent\n]\n\n@NgModule({\n  declarations,\n  imports: [\n    CommonModule,\n    IonicModule\n  ],\n  exports: declarations\n})\nexport class ComponentsVisorModule { }\n","import { Component, ElementRef, HostListener, Input, OnInit, ViewChild } from '@angular/core';\nimport { DataDuration } from 'src/app/interfaces/interface';\nimport { UiService } from 'src/app/services/ui.service';\nimport { ServicioService } from 'src/app/servicio.service';\nimport { environment } from 'src/environments/environment';\n\n\n@Component({\n  selector: 'app-pdf',\n  templateUrl: './pdf.component.html',\n  styleUrls: ['./pdf.component.scss'],\n})\nexport class PdfComponent implements OnInit {\n  @ViewChild('theCanvas', { static: true }) theCanvas: ElementRef<HTMLCanvasElement>;\n  // @ViewChild('storieAudio', { static: true }) storieAudio: ElementRef<HTMLAudioElement>;\n  @Input() url = '';\n  @Input() titulo = '';\n\n  private storieAudio: HTMLAudioElement = undefined;\n  private _scale = 0.8;\n  private _ctx = undefined;\n  private _pageNumPending = null;\n  private pdfjsLib = undefined;\n  private _durationData: DataDuration[] = [];\n  private _durationPage: DataDuration = undefined;\n\n  public pdfDoc = null;\n  public pageRendering = false;\n  public pageNum = 1;\n  public totalPages = 1;\n  public audioUrl = undefined;\n  private fixedTitle: string = undefined;\n  // private audio: HTMLAudioElement = undefined;\n\n\n  constructor(\n    private uiSv: UiService,\n    private servicio: ServicioService\n  ) { }\n\n  async ngOnInit() {\n    const fixedTitle = this.removeAccents(this.titulo); \n    this.fixedTitle = fixedTitle;\n    await this.getData();\n    this.audioUrl = `${environment.cuentosUrl}/${fixedTitle}.mp3`;\n    this.pdfjsLib = window['pdfjs-dist/build/pdf'];\n    this.pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';\n    this.getPdf();\n  }\n\n  async getData(){\n    const data: any = await this.servicio.consultarCuentos('db');\n    const duration = data.audiosDuration;\n    this._durationData = duration.find(item => this.removeAccents(item.pdfName) === this.fixedTitle)?.data;\n  }\n\n  removeAccents(str: string){\n    return str.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLocaleLowerCase().replace(/ /g, '_');\n  }\n\n  async setAudio(pageNum){\n    const audioEl = this.storieAudio;\n    if(!audioEl.paused){\n      audioEl.pause();\n    }\n    this._durationPage = this._durationData.find((x) => x.page === pageNum);\n    if(this._durationPage){\n      audioEl.currentTime = this._durationPage.init;\n      await audioEl.play();\n    }\n  }\n\n  async checkTime(ev?){\n    const audioEl = ev?.target || this.storieAudio;\n    console.log(`Pagina: ${this.pageNum} audioEl.currentTime :>> `, audioEl.currentTime);\n    if(this._durationPage && audioEl.currentTime > this._durationPage.end){\n      audioEl.pause();\n    }\n  }\n\n  async getPdf(){\n    await this.uiSv.showLoading();\n    this._ctx = this.theCanvas.nativeElement.getContext('2d');\n    this.pdfjsLib.getDocument(this.url).promise.then(async ( pdfDoc_: any ) => {\n      this.pdfDoc = pdfDoc_;\n      this.totalPages = this.pdfDoc.numPages;\n      await this.uiSv.dismissLoading();\n      this.renderPage(this.pageNum);\n    });\n  }\n\n  async renderPage(num) {\n    try{\n\n      this.pageRendering = true;\n      // Using promise to fetch the page\n      const canvas = this.theCanvas.nativeElement;\n      await this.uiSv.showLoading('Cargando PDF.');\n      this.pdfDoc.getPage(num).then((page) => {\n        const viewport = page.getViewport({scale: 1});\n        console.log(viewport);\n        canvas.height = viewport.height;\n        canvas.width = viewport.width;\n    \n        // Render PDF page into canvas context\n        const renderContext = {\n          canvasContext: this._ctx,\n          viewport: viewport\n        };\n  \n        setTimeout(() => {\n          const renderTask = page.render(renderContext);\n      \n          // Wait for rendering to finish\n          renderTask.promise.then(async () => {\n            this.pageRendering = false;\n            if (this._pageNumPending !== null) {\n              // New page rendering is pending\n              this.renderPage(this._pageNumPending);\n              this._pageNumPending = null;\n            }\n            await this.uiSv.dismissLoading();\n            \n            if(!this.storieAudio){\n              \n              await this.uiSv.showLoading('Cargando Audio.');\n              this.storieAudio = new Audio(this.audioUrl);\n              this.storieAudio.addEventListener('canplaythrough', async () => {\n                this.storieAudio.addEventListener('timeupdate', async () => {\n                  // console.log('object :>> ', object);\n                  await this.checkTime();\n                });\n                await this.uiSv.dismissLoading();\n              })\n\n            }else{\n              this.setAudio(this.pageNum);\n            }\n  \n          });\n        }, 100)\n      });\n    }catch(err){\n      console.error(err);\n      await this.uiSv.dismissLoading();\n\n    }\n  \n    // Update page counters\n    // document.getElementById('page_num').textContent = num;\n  }\n\n  nextPage(forward){\n    if(forward && this.pageNum < this.totalPages){\n      this.pageNum++;\n    }else if(!forward && this.pageNum > 1){\n      this.pageNum--;\n    }\n    this.renderPage(this.pageNum);\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { VisorPage } from './visor.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: VisorPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class VisorPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { VisorPageRoutingModule } from './visor-routing.module';\r\n\r\nimport { VisorPage } from './visor.page';\r\nimport { PipesModule } from 'src/app/pipes/pipes.module';\r\nimport { ComponentsModule } from 'src/app/components/components.module';\r\nimport { ComponentsVisorModule } from './components/components.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    VisorPageRoutingModule,\r\n    PipesModule,\r\n    ComponentsModule,\r\n    ComponentsVisorModule\r\n  ],\r\n  declarations: [VisorPage]\r\n})\r\nexport class VisorPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { NavController } from '@ionic/angular';\r\nimport { environment } from 'src/environments/environment';\r\n\r\n@Component({\r\n  selector: 'app-visor',\r\n  templateUrl: './visor.page.html',\r\n  styleUrls: ['./visor.page.scss'],\r\n})\r\n\r\nexport class VisorPage implements OnInit {\r\n  \r\n  public titulo = \"Titulo\";\r\n  public id = this.route.snapshot.paramMap.get('id');\r\n  public url = environment.cuentosUrl;\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private navCtrl: NavController\r\n  ) { }\r\n  \r\n  ngOnInit() {\r\n    this.titulo = this.route.snapshot.paramMap.get('titulo');\r\n  }\r\n\r\n  async back(){\r\n    await this.navCtrl.navigateBack('tab/principal/cuentos');\r\n  }\r\n\r\n}\r\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}